<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Herbalife Pricing ‚Äî Distributor App</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root {
    --green:       #22c55e;
    --green-dim:   #16a34a;
    --green-glass: rgba(34,197,94,0.10);
    --green-glow:  rgba(34,197,94,0.22);
    --accent:      #6366f1;
    --accent-glass:rgba(99,102,241,0.10);
    --fg:          #18181b;
    --fg2:         #3f3f46;
    --fg3:         #a1a1aa;
    --bg:          #f0fdf4;
    --bg2:         #dcfce7;
    --card:        #ffffff;
    --card2:       #f7fffe;
    --border:      rgba(34,197,94,0.14);
    --border-soft: rgba(0,0,0,0.06);
    --shadow:      0 2px 16px rgba(34,197,94,0.08), 0 1px 4px rgba(0,0,0,0.05);
    --shadow-lg:   0 8px 40px rgba(34,197,94,0.13), 0 2px 10px rgba(0,0,0,0.07);
    --radius:      20px;
    --radius-sm:   13px;
    --radius-xs:   9px;
    --font-sans:   'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-serif:  'Instrument Serif', Georgia, serif;
    --transition:  all 0.2s cubic-bezier(0.3,0,0.2,1);
    --topbar-bg:   rgba(240,253,244,0.88);
  }

  body.dark {
    --fg:    #f0fdf4;
    --fg2:   #a1a1aa;
    --fg3:   #52525b;
    --bg:    #0a0f0d;
    --bg2:   #0f1a12;
    --card:  #111714;
    --card2: #162019;
    --border:rgba(34,197,94,0.16);
    --border-soft:rgba(255,255,255,0.06);
    --shadow:0 2px 20px rgba(0,0,0,0.45), 0 1px 4px rgba(0,0,0,0.3);
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.55), 0 2px 8px rgba(0,0,0,0.35);
    --topbar-bg: rgba(10,15,13,0.92);
    --card2: #151e17;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  html { font-size: 16px; }

  body {
    font-family: var(--font-sans);
    background: var(--bg);
    color: var(--fg);
    transition: background 0.35s, color 0.35s;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    background-image: radial-gradient(ellipse at 20% 0%, rgba(34,197,94,0.08) 0%, transparent 60%),
                      radial-gradient(ellipse at 80% 100%, rgba(99,102,241,0.05) 0%, transparent 50%);
    background-attachment: fixed;
  }

  body.dark {
    background-image: radial-gradient(ellipse at 20% 0%, rgba(34,197,94,0.07) 0%, transparent 60%),
                      radial-gradient(ellipse at 80% 100%, rgba(99,102,241,0.06) 0%, transparent 50%);
  }

  /* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
  .topbar {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--topbar-bg);
    backdrop-filter: saturate(180%) blur(24px);
    -webkit-backdrop-filter: saturate(180%) blur(24px);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    height: 62px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.35s;
  }

  .topbar-brand {
    display: flex;
    align-items: center;
    gap: 11px;
  }

  .brand-icon {
    width: 34px;
    height: 34px;
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 17px;
    box-shadow: 0 3px 12px rgba(34,197,94,0.4), 0 1px 3px rgba(34,197,94,0.25);
  }

  .brand-name {
    font-size: 16px;
    font-weight: 600;
    letter-spacing: -0.4px;
    color: var(--fg);
  }

  .brand-sub {
    font-size: 10.5px;
    color: var(--green);
    font-weight: 500;
    letter-spacing: 0.2px;
    margin-top: 1px;
  }

  .topbar-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .dist-pill {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 100px;
    padding: 6px 16px;
    box-shadow: var(--shadow);
    transition: box-shadow 0.2s, border-color 0.2s;
  }

  .dist-pill:focus-within {
    border-color: var(--green);
    box-shadow: 0 0 0 3px var(--green-glass);
  }

  .dist-pill input {
    border: none;
    background: transparent;
    font-size: 13px;
    font-family: var(--font-sans);
    color: var(--fg);
    width: 155px;
    outline: none;
    font-weight: 500;
  }

  .dist-pill input::placeholder { color: var(--fg3); font-weight: 400; }

  .icon-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1.5px solid var(--border);
    background: var(--card);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: var(--transition);
    box-shadow: var(--shadow);
  }

  .icon-btn:hover { transform: scale(1.07); box-shadow: var(--shadow-lg); border-color: var(--green); }
  .icon-btn:active { transform: scale(0.95); }

  /* ‚îÄ‚îÄ TAB NAV ‚îÄ‚îÄ */
  .tab-nav {
    display: flex;
    justify-content: center;
    padding: 16px 24px 0;
    gap: 2px;
  }

  .tab-nav-inner {
    display: flex;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 100px;
    padding: 4px;
    gap: 2px;
    box-shadow: var(--shadow);
  }

  .tab-btn {
    padding: 8px 24px;
    border-radius: 100px;
    border: none;
    background: transparent;
    font-family: var(--font-sans);
    font-size: 13.5px;
    font-weight: 500;
    color: var(--fg3);
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
  }

  .tab-btn.active {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    font-weight: 600;
    box-shadow: 0 2px 10px rgba(34,197,94,0.35), 0 1px 3px rgba(34,197,94,0.2);
  }

  .tab-btn:hover:not(.active) { color: var(--fg2); background: var(--green-glass); }

  /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
  .page { display: none; padding: 20px 24px 48px; max-width: 1300px; margin: 0 auto; }
  .page.active { display: block; animation: fadeUp 0.22s ease; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--card);
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, #22c55e, #6366f1, transparent);
    opacity: 0.6;
  }

  .card-header {
    padding: 22px 24px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }

  .card-title {
    font-size: 16px;
    font-weight: 700;
    letter-spacing: -0.3px;
    color: var(--fg);
  }

  .card-subtitle {
    font-size: 12px;
    color: var(--fg3);
    margin-top: 3px;
  }

  .card-body { padding: 20px 24px 26px; }

  /* ‚îÄ‚îÄ BILL NAME ROW ‚îÄ‚îÄ */
  .bill-name-row {
    display: flex;
    gap: 12px;
    align-items: flex-end;
    margin-bottom: 18px;
    flex-wrap: wrap;
  }

  .field-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex: 1;
    min-width: 180px;
  }

  .field-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--green-dim);
    text-transform: uppercase;
    letter-spacing: 0.7px;
  }

  .field-note {
    font-size: 10.5px;
    color: var(--fg3);
    font-style: italic;
    margin-top: -2px;
  }

  .input, select.input {
    font-family: var(--font-sans);
    font-size: 14px;
    color: var(--fg);
    background: var(--card2);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 11px 14px;
    outline: none;
    transition: var(--transition);
    width: 100%;
    appearance: none;
    -webkit-appearance: none;
  }

  select.input {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2322c55e' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 13px center;
    padding-right: 34px;
  }

  .input:focus, select.input:focus {
    border-color: var(--green);
    box-shadow: 0 0 0 3.5px var(--green-glass);
    background: var(--card);
  }

  .input::placeholder { color: var(--fg3); }

  body.dark .input, body.dark select.input {
    background: var(--card2);
    color: var(--fg);
  }

  /* ‚îÄ‚îÄ CONTROLS STRIP ‚îÄ‚îÄ */
  .controls-strip {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    padding: 18px 20px;
    background: linear-gradient(135deg, var(--green-glass), transparent);
    border-radius: var(--radius-sm);
    border: 1.5px solid var(--border);
    margin-bottom: 20px;
    align-items: flex-end;
  }

  .controls-strip .field-group { min-width: 140px; flex: 1; max-width: 240px; }

  .toggle-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 6px;
  }

  .toggle {
    position: relative;
    width: 46px;
    height: 27px;
    background: var(--border-soft);
    border-radius: 100px;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    flex-shrink: 0;
  }

  .toggle:after {
    content: '';
    position: absolute;
    top: 3.5px;
    left: 3.5px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    transition: var(--transition);
    box-shadow: 0 1px 5px rgba(0,0,0,0.25);
  }

  .toggle.on { background: linear-gradient(135deg, #22c55e, #16a34a); box-shadow: 0 2px 8px rgba(34,197,94,0.35); }
  .toggle.on:after { left: calc(100% - 23.5px); }

  .toggle-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--fg2);
  }

  /* ‚îÄ‚îÄ LEVEL BADGE ‚îÄ‚îÄ */
  .level-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: var(--green-glass);
    color: var(--green-dim);
    font-size: 11px;
    font-weight: 700;
    padding: 3px 9px;
    border-radius: 7px;
    border: 1px solid var(--green-glow);
    margin-left: 6px;
  }

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .table-wrap {
    overflow-x: auto;
    border-radius: var(--radius-sm);
    border: 1.5px solid var(--border);
    margin-bottom: 18px;
    box-shadow: inset 0 1px 4px rgba(34,197,94,0.04);
  }

  table {
    width: 100%;
    min-width: 1000px;
    border-collapse: collapse;
  }

  thead th {
    background: linear-gradient(135deg, var(--green-glass), rgba(99,102,241,0.04));
    padding: 12px 12px;
    text-align: left;
    font-size: 11px;
    font-weight: 700;
    color: var(--green-dim);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    border-bottom: 1.5px solid var(--border);
    white-space: nowrap;
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
  }

  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: rgba(34,197,94,0.04); }

  tbody td {
    padding: 8px 8px;
    vertical-align: middle;
  }

  .cell-input {
    font-family: var(--font-sans);
    font-size: 13px;
    color: var(--fg);
    background: transparent;
    border: 1.5px solid transparent;
    border-radius: var(--radius-xs);
    padding: 7px 10px;
    width: 100%;
    outline: none;
    transition: var(--transition);
  }

  .cell-input:focus {
    background: var(--card);
    border-color: var(--green);
    box-shadow: 0 0 0 3px var(--green-glass);
  }

  .cell-input[readonly] {
    color: var(--fg2);
    cursor: default;
    font-weight: 600;
  }

  .cell-input.auto-filled {
    border-color: var(--green) !important;
    background: var(--green-glass) !important;
    color: var(--green-dim);
    font-weight: 700;
  }

  .cell-input::placeholder { color: var(--fg3); }

  body.dark .cell-input:focus { background: var(--card2); }

  /* Product name cell */
  .prod-wrap { position: relative; }

  .prod-toggle {
    position: absolute;
    right: 6px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--green-glass);
    color: var(--green-dim);
    border: 1px solid var(--green-glow);
    border-radius: 6px;
    width: 24px;
    height: 24px;
    font-size: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    z-index: 5;
  }

  .prod-toggle:hover { background: var(--green-glow); transform: translateY(-50%) scale(1.08); }

  .prod-dd {
    display: none;
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    min-width: 340px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-lg);
    z-index: 500;
    max-height: 320px;
    overflow-y: auto;
  }

  .prod-dd.open { display: block; animation: fadeUp 0.15s ease; }

  .dd-cat {
    padding: 9px 14px 6px;
    font-size: 10px;
    font-weight: 800;
    color: var(--green-dim);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    position: sticky;
    top: 0;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(8px);
  }

  .dd-item {
    padding: 9px 14px;
    font-size: 12.5px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    transition: background 0.12s;
    border-bottom: 1px solid var(--border);
  }

  .dd-item:last-child { border-bottom: none; }
  .dd-item:hover { background: var(--green-glass); color: var(--green-dim); }

  .dd-prices {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
  }

  .dd-tag {
    font-size: 10px;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 5px;
    white-space: nowrap;
  }

  .dd-tag.mrp { background: rgba(99,102,241,0.1); color: #6366f1; }
  .dd-tag.buy { background: var(--green-glass); color: var(--green-dim); }

  body.dark .dd-tag.mrp { background: rgba(99,102,241,0.18); color: #818cf8; }

  /* profit cell */
  .profit-pos { color: var(--green-dim); font-weight: 700; }
  .profit-neg { color: #ef4444; font-weight: 700; }

  /* del btn */
  .del-btn {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 1.5px solid rgba(239,68,68,0.25);
    background: rgba(239,68,68,0.06);
    color: #ef4444;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
  }

  .del-btn:hover { background: rgba(239,68,68,0.13); border-color: rgba(239,68,68,0.5); transform: scale(1.1) rotate(5deg); }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn {
    font-family: var(--font-sans);
    font-weight: 600;
    font-size: 14px;
    border: none;
    border-radius: var(--radius-sm);
    padding: 11px 22px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 7px;
    transition: var(--transition);
    letter-spacing: -0.1px;
  }

  .btn:active { transform: scale(0.96); }

  .btn-green {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    box-shadow: 0 2px 14px rgba(34,197,94,0.35), 0 1px 4px rgba(34,197,94,0.2);
  }

  .btn-green:hover { box-shadow: 0 4px 22px rgba(34,197,94,0.45), 0 2px 6px rgba(34,197,94,0.28); transform: translateY(-1.5px); }

  .btn-outline {
    background: var(--card);
    color: var(--fg);
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow);
  }

  .btn-outline:hover { border-color: var(--green); color: var(--green-dim); box-shadow: 0 0 0 3px var(--green-glass); }

  .btn-blue {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    color: white;
    box-shadow: 0 2px 12px rgba(99,102,241,0.35);
  }

  .btn-blue:hover { box-shadow: 0 4px 20px rgba(99,102,241,0.45); transform: translateY(-1.5px); }

  .btn-red {
    background: rgba(239,68,68,0.08);
    color: #ef4444;
    border: 1.5px solid rgba(239,68,68,0.18);
  }

  .btn-red:hover { background: rgba(239,68,68,0.14); }

  .btn-full { width: 100%; justify-content: center; }

  .btn-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }

  /* ‚îÄ‚îÄ SAVE BAR ‚îÄ‚îÄ */
  .save-bar {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-top: 4px;
  }

  /* ‚îÄ‚îÄ SAVED BILLS PAGE ‚îÄ‚îÄ */
  .bills-grid {
    display: grid;
    gap: 16px;
    grid-template-columns: 1fr;
  }

  .bill-card {
    background: var(--card);
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: var(--transition);
    position: relative;
  }

  .bill-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, #22c55e, #6366f1, transparent);
    opacity: 0.5;
  }

  .bill-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); border-color: var(--green); }

  .bill-card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 22px 22px 16px;
    gap: 12px;
    flex-wrap: wrap;
  }

  .bill-card-meta h3 {
    font-size: 17px;
    font-weight: 700;
    letter-spacing: -0.4px;
    margin-bottom: 5px;
    color: var(--fg);
  }

  .bill-meta-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
  }

  .bill-meta-pill {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11.5px;
    color: var(--fg3);
    background: var(--card2);
    border: 1px solid var(--border);
    padding: 3px 9px;
    border-radius: 100px;
    font-weight: 500;
  }

  .bill-card-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .bill-card-actions .btn {
    padding: 8px 16px;
    font-size: 12.5px;
  }

  .bill-divider { height: 1px; background: var(--border); margin: 0 22px; }

  .bill-items-list { padding: 14px 22px; }

  .bill-item-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    gap: 12px;
    font-size: 13px;
  }

  .bill-item-row:last-child { border-bottom: none; }

  .bill-item-name {
    font-weight: 500;
    color: var(--fg);
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .bill-item-stats {
    display: flex;
    gap: 14px;
    color: var(--fg3);
    font-size: 12px;
    flex-shrink: 0;
    font-weight: 500;
  }

  .bill-card-footer {
    background: linear-gradient(135deg, var(--green-glass), transparent);
    border-top: 1.5px solid var(--border);
    padding: 16px 22px;
    display: flex;
    gap: 0;
    flex-wrap: wrap;
  }

  .footer-stat {
    flex: 1;
    min-width: 120px;
    padding: 0 18px;
    border-right: 1px solid var(--border);
    text-align: center;
  }

  .footer-stat:first-child { padding-left: 0; }
  .footer-stat:last-child { border-right: none; padding-right: 0; }

  .footer-stat-label {
    font-size: 10.5px;
    color: var(--fg3);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }

  .footer-stat-val {
    font-size: 20px;
    font-weight: 800;
    color: var(--fg);
    letter-spacing: -0.7px;
  }

  .footer-stat-val.green { color: var(--green-dim); }
  .footer-stat-val.red   { color: #ef4444; }

  /* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
  .search-wrap {
    position: relative;
    margin-bottom: 18px;
  }

  .search-wrap .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 15px;
    color: var(--fg3);
    pointer-events: none;
  }

  .search-wrap input {
    padding-left: 42px;
    height: 46px;
    font-size: 14.5px;
  }

  /* ‚îÄ‚îÄ SUMMARY PAGE ‚îÄ‚îÄ */
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .stat-card {
    background: var(--card);
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow);
    padding: 26px 24px 20px;
    position: relative;
    overflow: hidden;
    transition: var(--transition);
  }

  .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, #22c55e, #6366f1);
  }

  .stat-card::after {
    content: '';
    position: absolute;
    bottom: -20px; right: -20px;
    width: 80px; height: 80px;
    background: radial-gradient(circle, var(--green-glass) 0%, transparent 70%);
    pointer-events: none;
  }

  .stat-card-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--green-dim);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    margin-bottom: 12px;
  }

  .stat-card-val {
    font-size: 36px;
    font-weight: 800;
    letter-spacing: -1.5px;
    color: var(--fg);
    line-height: 1;
  }

  .stat-card-val.green { color: var(--green-dim); }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(6px);
    z-index: 900;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-backdrop.open { display: flex; }

  .modal {
    background: var(--card);
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow-lg);
    width: 100%;
    max-width: 640px;
    max-height: 85vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.25s cubic-bezier(0.34,1.2,0.64,1);
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .modal-header {
    padding: 24px 24px 18px;
    border-bottom: 1.5px solid var(--border);
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    flex-shrink: 0;
    background: linear-gradient(135deg, var(--green-glass), transparent);
  }

  .modal-header h2 { font-size: 19px; font-weight: 800; letter-spacing: -0.5px; }
  .modal-header .modal-sub { font-size: 12px; color: var(--fg3); margin-top: 3px; }

  .modal-close {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 1.5px solid var(--border);
    background: var(--card2);
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--fg3);
    transition: var(--transition);
    flex-shrink: 0;
    line-height: 1;
  }

  .modal-close:hover { color: #ef4444; border-color: #ef4444; transform: rotate(90deg); }

  .modal-body { overflow-y: auto; padding: 20px 24px 24px; flex: 1; }

  .modal-item {
    background: var(--card2);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px 18px;
    margin-bottom: 12px;
    transition: var(--transition);
  }

  .modal-item:hover { border-color: var(--green); }

  .modal-item h4 {
    font-size: 14px;
    font-weight: 700;
    color: var(--fg);
    margin-bottom: 12px;
    letter-spacing: -0.2px;
  }

  .modal-detail {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    font-size: 13px;
    border-bottom: 1px solid var(--border);
  }

  .modal-detail:last-child { border-bottom: none; }
  .modal-detail span:first-child { color: var(--fg3); }
  .modal-detail strong { font-weight: 600; }

  .modal-warning {
    background: rgba(251,191,36,0.08);
    border: 1.5px solid rgba(251,191,36,0.2);
    border-radius: var(--radius-xs);
    padding: 10px 14px;
    font-size: 12px;
    color: #92400e;
    margin-bottom: 16px;
    font-style: italic;
  }

  body.dark .modal-warning { background: rgba(251,191,36,0.06); border-color: rgba(251,191,36,0.18); color: #fbbf24; }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast-wrap {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    pointer-events: none;
  }

  .toast {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    padding: 11px 22px;
    border-radius: 100px;
    font-size: 13.5px;
    font-weight: 600;
    box-shadow: 0 4px 20px rgba(34,197,94,0.4), 0 2px 8px rgba(0,0,0,0.15);
    animation: toastIn 0.25s cubic-bezier(0.34,1.2,0.64,1);
    white-space: nowrap;
  }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(12px) scale(0.92); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  /* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
  .empty {
    text-align: center;
    padding: 64px 20px;
    color: var(--fg3);
  }

  .empty-icon { font-size: 48px; margin-bottom: 14px; }
  .empty h3 { font-size: 17px; font-weight: 700; color: var(--fg2); margin-bottom: 7px; }
  .empty p  { font-size: 13.5px; }

  /* ‚îÄ‚îÄ WATERMARK ‚îÄ‚îÄ */
  .watermark {
    position: fixed;
    bottom: 12px;
    right: 16px;
    font-size: 11px;
    color: var(--fg3);
    pointer-events: none;
    z-index: 50;
  }

  /* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
  .sep { height: 1px; background: var(--border); margin: 16px 0; }

  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  input[type=number] { -moz-appearance: textfield; }

  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--green-glow); border-radius: 10px; }

  @media (max-width: 600px) {
    .topbar { padding: 0 14px; }
    .page { padding: 14px 14px 40px; }
    .card-body { padding: 14px 16px 18px; }
    .card-header { padding: 16px 16px 0; }
    .controls-strip .field-group { max-width: 100%; }
    .dist-pill input { width: 110px; }
  }
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-brand">
    <div class="brand-icon">üåø</div>
    <div>
      <div class="brand-name">Herbalife Pricing</div>
      <div class="brand-sub">Distributor Dashboard</div>
    </div>
  </div>
  <div class="topbar-right">
    <div class="dist-pill">
      <span style="font-size:13px;color:var(--green)">üë§</span>
      <input type="text" id="distName" placeholder="Distributor name‚Ä¶">
    </div>
    <button class="icon-btn" id="darkBtn" onclick="toggleDark()" title="Dark mode">üåô</button>
  </div>
</div>

<!-- TAB NAV -->
<div class="tab-nav">
  <div class="tab-nav-inner">
    <button class="tab-btn active" onclick="showTab('input',this)">Product Input</button>
    <button class="tab-btn" onclick="showTab('saved',this)">Saved Bills</button>
    <button class="tab-btn" onclick="showTab('summary',this)">Summary</button>
  </div>
</div>

<!-- INPUT PAGE -->
<div id="tab-input" class="page active">

  <div class="card" style="margin-bottom:18px">
    <div class="card-header">
      <div>
        <div class="card-title">New Bill</div>
        <div class="card-subtitle">Enter a name and configure your pricing settings</div>
      </div>
    </div>
    <div class="card-body">
      <div class="bill-name-row">
        <div class="field-group">
          <label class="field-label">Bill Name</label>
          <input class="input" type="text" id="billName" placeholder="e.g. January Sales">
        </div>
      </div>
      <div class="controls-strip">
        <div class="field-group">
          <label class="field-label">Distributor Level</label>
          <div class="field-note">Sets your buy price from Herbalife's price list</div>
          <select class="input" id="distLevel" onchange="onLevelChange()">
            <option value="retail">Retail Price</option>
            <option value="earnBase">‚òÖ Earn Base</option>
            <option value="p25">25% ‚Äî Senior Consultant</option>
            <option value="p35">35% ‚Äî Qualified Producer</option>
            <option value="p42">42% ‚Äî Success Builder</option>
            <option value="p50" selected>50% ‚Äî Supervisor</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">Global Markup %</label>
          <div class="field-note">Added on top of buy price</div>
          <input class="input" type="number" id="globalMarkup" value="0" min="0" step="0.01" oninput="onMarkupChange()">
        </div>
        <div class="field-group">
          <label class="field-label">Auto-Sync Markup</label>
          <div class="field-note">Apply markup to all rows</div>
          <div class="toggle-row">
            <div class="toggle" id="autoToggle" onclick="toggleAuto()"></div>
            <div>
              <div class="toggle-label" id="autoLabel">Off</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body" style="padding-top:22px">
      <div class="table-wrap">
        <table id="prodTable">
          <thead>
            <tr>
              <th style="width:220px">Product</th>
              <th style="width:90px">MRP (‚Çπ)</th>
              <th style="width:100px">Buy Price (‚Çπ)</th>
              <th style="width:80px">Markup %</th>
              <th style="width:100px">Sell / Unit</th>
              <th style="width:60px">Qty</th>
              <th style="width:100px">Total (‚Çπ)</th>
              <th style="width:85px">Profit (‚Çπ)</th>
              <th style="width:44px"></th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      <div class="save-bar">
        <button class="btn btn-outline" onclick="addRow()">Ôºã Add Row</button>
        <button class="btn btn-green" onclick="saveBill()">üíæ Save Bill</button>
      </div>
    </div>
  </div>
</div>

<!-- SAVED PAGE -->
<div id="tab-saved" class="page">
  <div class="search-wrap">
    <span class="search-icon">üîç</span>
    <input class="input" type="text" id="searchInput" placeholder="Search bills‚Ä¶" oninput="searchBills()">
  </div>
  <div id="billsGrid" class="bills-grid"></div>
</div>

<!-- SUMMARY PAGE -->
<div id="tab-summary" class="page">
  <div class="summary-grid" id="summaryGrid">
    <div class="stat-card">
      <div class="stat-card-label">Total Bills</div>
      <div class="stat-card-val" id="sTotalBills">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Total Products</div>
      <div class="stat-card-val" id="sTotalProds">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Total Revenue</div>
      <div class="stat-card-val" id="sTotalRev">‚Çπ0</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-label">Total Profit</div>
      <div class="stat-card-val green" id="sTotalProfit">‚Çπ0</div>
    </div>
  </div>
  <div class="btn-row">
    <button class="btn btn-green" onclick="exportCSV()">‚Üì Export CSV</button>
    <button class="btn btn-outline" onclick="window.print()">üñ® Print Summary</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-backdrop" id="modal">
  <div class="modal">
    <div class="modal-header">
      <div>
        <h2 id="modalTitle">Bill Details</h2>
        <div class="modal-sub" id="modalSub"></div>
      </div>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="modal-warning">‚ö†Ô∏è Saved bills may not reflect current calculations if distributor level, markup, or prices changed after this bill was generated.</div>
      <div id="modalItems"></div>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>
<div class="watermark">Made by Vedant Suryawanshi</div>

<script>
// ‚îÄ‚îÄ‚îÄ PRICE TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PRICE_TABLE = {
  'formula 1 - nutritional shake mix - vanilla - 500 gms':        [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - chocolate - 500 gms':      [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - mango - 500 gms':          [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - orange cream - 500 gms':   [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - strawberry - 500 gms':     [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - kulfi - 500 gms':          [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - banana caramel - 500 gms': [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 - nutritional shake mix - rose kheer - 500 gms':     [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 nutritional shake mix - paan - 500 gms':             [2179,2075,1776,1713,1526,1396,1246],
  'formula 1 mango - 750 gms':      [3227,3073,2628,2537,2261,2068,1847],
  'formula 1 vanilla - 750 gms':    [3227,3073,2628,2537,2261,2068,1847],
  'formula 1 kulfi - 750 gms':      [3227,3073,2628,2537,2261,2068,1847],
  'formula 1 rose kheer - 750 gms': [3227,3073,2628,2537,2261,2068,1847],
  'personalized protein powder - 200 gms': [1295,1233,1054,1018,907,830,741],
  'personalized protein powder - 400 gms': [2485,2366,2023,1953,1741,1592,1422],
  'shakemate - 500 gms':            [653,621,531,572,540,517,491],
  'liftoff watermelon (30 packets)': [4119,3922,3354,3238,2886,2639,2357],
  'ocular defense':                  [1927,1835,1570,1515,1350,1234,1103],
  'male factor +':                   [3410,3247,2776,2681,2389,2185,1952],
  "woman's choice":                  [1245,1185,1013,978,872,798,712],
  'vritilife brain health - 60 tablets': [1464,1394,1192,1151,1026,938,838],
  'vritilife facial cleanser (100 ml)': [1165,987,844,916,816,746,667],
  'vritilife facial toner (100 ml)':    [1322,1120,958,1039,926,847,756],
  'vritilife facial serum (30 ml)':     [3022,2561,2190,2376,2118,1937,1730],
  'vritilife moisturizer (100 ml)':     [1473,1248,1067,1158,1032,944,843],
  'hn - skin booster - orange - 10gms * 30 sachets': [3910,3723,2749,3188,2899,2697,2466],
  'hn - skin booster canister':         [3910,3723,2849,3161,2862,2653,2413],
  'vritilife immune health - 60 tablets': [1528,1455,1245,1201,1070,979,874],
  'afresh energy drink mix - ginger - 50 gms':        [812,773,662,646,580,534,481],
  'afresh energy drink mix - elaichi - 50 gms':       [812,773,662,638,568,520,464],
  'afresh energy drink mix - lemon - 50 gms':         [812,773,662,638,568,520,464],
  'afresh energy drink mix - peach - 50 gms':         [812,773,662,638,568,520,464],
  'afresh energy drink mix - cinnamon - 50 gms':      [812,773,662,638,568,520,464],
  'afresh energy drink mix - kashmiri kahwa - 40 gms':[812,773,662,638,568,520,464],
  'afresh energy drink mix - tulsi (basil) - 50 gms': [812,773,630,646,580,534,481],
  'h24 hydrate - 5gms * 20 sachets':          [1636,1558,1333,1286,1146,1048,936],
  'h24 rebuild strength - 50gms * 10 sachets':[2616,2491,2035,2081,1868,1718,1547],
  'dinoshake - chocolicious - 200 gms':       [1115,1061,908,876,780,714,637],
  "dinoshake nutritional children's drink mix - strawberry - 200 gms":[1115,1061,908,876,780,714,637],
  'activated fiber - 90 tablets':                      [1636,1558,1333,1286,1146,1048,936],
  'active fiber complex - unflavoured - 200 gms':      [2559,2437,2084,2012,1793,1640,1465],
  'aloe plus - 60 capsules':                           [1059,1008,863,832,741,678,605],
  'herbal aloe concentrate - unflavored (original) - 500 ml':[2696,2567,2195,2119,1889,1727,1543],
  'simply probiotic - 1gms * 30 sachets':              [2209,2103,1799,1736,1547,1415,1264],
  'vritilife triphala':                                [1089,1037,887,856,763,698,623],
  'herbalife calcium tablets - 60 tablets': [1203,1145,979,945,842,771,688],
  'joint support - 90 tablets':             [2455,2338,2000,1930,1720,1573,1405],
  'herbalife niteworks - 300 gms': [7128,6788,5804,5604,4994,4568,4080],
  'herbalifeline - 60 softgels':   [2667,2540,2172,2097,1869,1709,1527],
  'beta heart - vanilla flavour - 15 gms * 15 sachets':[2242,2135,1576,1828,1663,1547,1414],
  'multivitamin mineral & herbal - 90 tablets':[2004,1908,1632,1575,1404,1284,1147],
  'sleep enhance':                             [1697,1616,1382,1334,1189,1087,971],
  'cell activator - new - 60 tablets':  [2215,2109,1804,1741,1551,1419,1267],
  'cell-u-loss advanced - 90 tablets':  [1705,1623,1388,1340,1194,1092,975],
  'herbal control - 90 tablets':        [3433,3269,2796,2699,2405,2199,1965],
};

const LEVEL_IDX   = {retail:1, earnBase:2, p25:3, p35:4, p42:5, p50:6};
const LEVEL_LABEL = {retail:'Retail',earnBase:'Earn Base',p25:'25%',p35:'35%',p42:'42%',p50:'50%'};

const productCategories = {
  'Weight Management': ['Formula 1 - Nutritional Shake Mix - Vanilla - 500 gms','Formula 1 - Nutritional Shake Mix - Chocolate - 500 gms','Formula 1 - Nutritional Shake Mix - Mango - 500 gms','Formula 1 - Nutritional Shake Mix - Orange Cream - 500 gms','Formula 1 - Nutritional Shake Mix - Strawberry - 500 gms','Formula 1 - Nutritional Shake Mix - Kulfi - 500 gms','Formula 1 - Nutritional Shake Mix - Banana Caramel - 500 gms','Formula 1 - Nutritional Shake Mix - Rose Kheer - 500 gms','Formula 1 Nutritional Shake Mix - Paan - 500 gms','Formula 1 Mango - 750 gms','Formula 1 Vanilla - 750 gms','Formula 1 Kulfi - 750 gms','Formula 1 Rose Kheer - 750 gms','Personalized Protein Powder - 200 gms','Personalized Protein Powder - 400 gms','ShakeMate - 500 gms'],
  'Eye Health': ['Ocular Defense','Liftoff Watermelon (30 Packets)'],
  "Men's Health": ['Male Factor +'],
  "Women's Health": ["Woman's Choice"],
  'Brain Health': ['Vritilife Brain Health - 60 tablets'],
  'Skin & Body Care': ['Vritilife Facial Cleanser (100 ml)','Vritilife Facial Toner (100 ml)','Vritilife Moisturizer (100 ml)','Vritilife Facial Serum (30 ml)','HN - Skin Booster Canister','HN - Skin Booster - Orange - 10gms * 30 Sachets'],
  'Immunity': ['Vritilife Immune Health - 60 tablets'],
  'Energy': ['Afresh Energy Drink Mix - Ginger - 50 gms','Afresh Energy Drink Mix - Elaichi - 50 gms','Afresh Energy Drink Mix - Lemon - 50 gms','Afresh Energy Drink Mix - Peach - 50 gms','Afresh Energy Drink Mix - Cinnamon - 50 gms','Afresh Energy Drink Mix - Kashmiri Kahwa - 40 gms','Afresh Energy Drink Mix - Tulsi (Basil) - 50 gms'],
  'Sports': ['H24 Hydrate - 5gms * 20 Sachets','H24 Rebuild Strength - 50gms * 10 Sachets'],
  'Children': ['DinoShake - Chocolicious - 200 gms',"Dinoshake Nutritional Children's Drink Mix - Strawberry - 200 gms"],
  'Digestive': ['Activated Fiber - 90 tablets','Active Fiber Complex - Unflavoured - 200 gms','Aloe Plus - 60 capsules','Herbal Aloe Concentrate - Unflavored (Original) - 500 ml','Simply Probiotic - 1gms * 30 Sachets','Vritilife Triphala'],
  'Bone & Joint': ['Herbalife Calcium Tablets - 60 tablets','Joint Support - 90 tablets'],
  'Cardiovascular': ['Herbalife Niteworks - 300 gms','Herbalifeline - 60 softgels','Beta Heart - Vanilla Flavour - 15 gms * 15 Sachets'],
  'Enhancers': ['Multivitamin Mineral & Herbal - 90 tablets','Sleep Enhance'],
  'Sleep Support': ['Cell Activator - New - 60 Tablets','Cell-U-Loss Advanced - 90 Tablets','Herbal Control - 90 Tablets']
};

function normName(s){ return s?s.trim().toLowerCase().replace(/[¬Æ‚Ñ¢‚Äì‚Äî]/g,'').replace(/\s*-\s*/g,' - ').replace(/\s+/g,' '):''; }
function getPrices(n){ const k=normName(n); if(PRICE_TABLE[k]) return PRICE_TABLE[k]; for(const[ki,v] of Object.entries(PRICE_TABLE)){if(k.includes(ki)||ki.includes(k)) return v;} return null; }
function getMRP(n){ const p=getPrices(n); return p?p[0]:null; }
function getBuy(n,lv){ const p=getPrices(n); return p?p[LEVEL_IDX[lv]||6]:null; }

// ‚îÄ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let S = {distName:'',bills:[],dark:false,level:'p50',markup:0,auto:false};

function load(){ try{ const d=localStorage.getItem('hbl3'); if(d) S=Object.assign({level:'p50',markup:0,auto:false},JSON.parse(d)); }catch(e){} }
function save(){ localStorage.setItem('hbl3',JSON.stringify(S)); }
function getLevel(){ return document.getElementById('distLevel').value||'p50'; }
function getMarkup(){ return parseFloat(document.getElementById('globalMarkup').value)||0; }

// ‚îÄ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleDark(){
  S.dark = !S.dark; save();
  document.body.classList.toggle('dark', S.dark);
  document.getElementById('darkBtn').textContent = S.dark ? '‚òÄÔ∏è' : 'üåô';
}

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(id, btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  btn.classList.add('active');
  if(id==='saved') renderBills();
  if(id==='summary') renderSummary();
}

// ‚îÄ‚îÄ‚îÄ LEVEL / MARKUP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onLevelChange(){
  S.level = getLevel(); save();
  document.querySelectorAll('#tableBody tr').forEach(r=>{ applyLevelToRow(r); });
}

function onMarkupChange(){
  S.markup = getMarkup(); save();
  if(S.auto){ document.querySelectorAll('#tableBody tr').forEach(r=>{ r.querySelector('.c-mk').value=S.markup; calcRow(r); }); }
}

function toggleAuto(){
  S.auto = !S.auto; save();
  const tog = document.getElementById('autoToggle');
  tog.classList.toggle('on', S.auto);
  document.getElementById('autoLabel').textContent = S.auto ? 'On ‚Äî syncing all rows' : 'Off';
  if(S.auto){ document.querySelectorAll('#tableBody tr').forEach(r=>{ r.querySelector('.c-mk').value=S.markup; calcRow(r); }); }
}

function applyLevelToRow(r){
  const name = r.querySelector('.c-name').value.trim();
  if(!name) return; // skip empty rows
  const bp   = getBuy(name, getLevel());
  const mrp  = getMRP(name);
  if(bp!==null){
    const bpI = r.querySelector('.c-bp');
    bpI.value = bp.toFixed(2);
    bpI.classList.add('auto-filled');
  }
  if(mrp!==null) r.querySelector('.c-mrp').value = mrp.toFixed(2);
  calcRow(r);
}

// ‚îÄ‚îÄ‚îÄ TABLE ROWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let rowId = 0;
function addRow(){
  const tbody = document.getElementById('tableBody');
  const id = rowId++;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><div class="prod-wrap">
      <input class="cell-input c-name" type="text" placeholder="Type or choose ‚ñº" data-rid="${id}">
      <button class="prod-toggle" onclick="toggleDD(event,${id})">‚ñº</button>
      <div class="prod-dd" id="dd-${id}"></div>
    </div></td>
    <td><input class="cell-input c-mrp" type="number" readonly placeholder="‚Äî"></td>
    <td><input class="cell-input c-bp" type="number" placeholder="Auto-fills" step="0.01" oninput="onBpInput(this)"></td>
    <td><input class="cell-input c-mk" type="number" placeholder="0" step="0.01" value="${S.markup||0}" oninput="onMkInput(this)"></td>
    <td><input class="cell-input c-sp" type="number" readonly></td>
    <td><input class="cell-input c-qty" type="number" value="1" min="1" step="1" oninput="calcRow(this.closest('tr'))"></td>
    <td><input class="cell-input c-fp" type="number" readonly></td>
    <td><input class="cell-input c-prf" type="number" readonly></td>
    <td><button class="del-btn" onclick="if(confirm('Delete this row?')) this.closest('tr').remove()">‚úï</button></td>
  `;
  tbody.appendChild(tr);
  buildDD(id);
}

function buildDD(id){
  const dd = document.getElementById(`dd-${id}`);
  const lv = getLevel();
  let html = '';
  for(const[cat,prods] of Object.entries(productCategories)){
    html += `<div class="dd-cat">${cat}</div>`;
    prods.forEach(p=>{
      const pr = getPrices(p);
      const mrpT = pr ? `<span class="dd-tag mrp">MRP ‚Çπ${pr[0]}</span>` : '';
      const buyT = pr ? `<span class="dd-tag buy">Buy ‚Çπ${pr[LEVEL_IDX[lv]||6]}</span>` : '';
      html += `<div class="dd-item" onclick="pickProduct('${p.replace(/'/g,"\\'")}',${id})">
        <span>${p}</span>
        <div class="dd-prices">${mrpT}${buyT}</div>
      </div>`;
    });
  }
  dd.innerHTML = html;
}

function toggleDD(e,id){
  e.preventDefault(); e.stopPropagation();
  const dd = document.getElementById(`dd-${id}`);
  const wasOpen = dd.classList.contains('open');
  document.querySelectorAll('.prod-dd.open').forEach(x=>x.classList.remove('open'));
  if(!wasOpen) dd.classList.add('open');
}

document.addEventListener('click', ()=>{ document.querySelectorAll('.prod-dd.open').forEach(x=>x.classList.remove('open')); });

function pickProduct(p, id){
  const nameI = document.querySelector(`[data-rid="${id}"]`);
  if(!nameI) return;
  nameI.value = p;
  document.getElementById(`dd-${id}`).classList.remove('open');
  const r = nameI.closest('tr');
  const lv = getLevel();
  const pr = getPrices(p);
  if(pr){
    r.querySelector('.c-mrp').value = pr[0].toFixed(2);
    const bpI = r.querySelector('.c-bp');
    bpI.value = pr[LEVEL_IDX[lv]||6].toFixed(2);
    bpI.classList.add('auto-filled');
    calcRow(r);
    toast(`‚úì ${p.length>30?p.slice(0,30)+'‚Ä¶':p}`);
  } else {
    calcRow(r);
  }
}

document.addEventListener('input', e=>{
  if(!e.target.classList.contains('c-name')) return;
  const id = e.target.getAttribute('data-rid');
  const dd = document.getElementById(`dd-${id}`);
  const q  = e.target.value.toLowerCase();
  if(q.length>0){
    let any=false;
    dd.querySelectorAll('.dd-item').forEach(el=>{
      const vis = el.querySelector('span').textContent.toLowerCase().includes(q);
      el.style.display = vis?'flex':'none';
      if(vis) any=true;
    });
    dd.querySelectorAll('.dd-cat').forEach(cat=>{
      let nxt=cat.nextElementSibling; let v=false;
      while(nxt&&!nxt.classList.contains('dd-cat')){ if(nxt.style.display!=='none') v=true; nxt=nxt.nextElementSibling; }
      cat.style.display=v?'block':'none';
    });
    if(any) dd.classList.add('open'); else dd.classList.remove('open');
  } else {
    dd.querySelectorAll('.dd-item,.dd-cat').forEach(x=>x.style.display='');
    dd.classList.remove('open');
  }
});

function onBpInput(input){
  input.classList.remove('auto-filled');
  calcRow(input.closest('tr'));
}

function onMkInput(input){
  if(S.auto){
    const v=parseFloat(input.value)||0;
    document.getElementById('globalMarkup').value=v;
    S.markup=v; save();
    document.querySelectorAll('#tableBody tr').forEach(r=>{r.querySelector('.c-mk').value=v; calcRow(r);});
  } else {
    calcRow(input.closest('tr'));
  }
}

function calcRow(r){
  const bp  = parseFloat(r.querySelector('.c-bp').value)||0;
  const mk  = parseFloat(r.querySelector('.c-mk').value)||0;
  const qty = parseInt(r.querySelector('.c-qty').value)||1;
  if(!bp){ r.querySelector('.c-sp').value=''; r.querySelector('.c-fp').value=''; r.querySelector('.c-prf').value=''; return; }
  const sp  = bp*(1+mk/100);
  const fp  = sp*qty;
  const prf = (sp-bp)*qty;
  r.querySelector('.c-sp').value  = sp.toFixed(2);
  r.querySelector('.c-fp').value  = fp.toFixed(2);
  const prfI = r.querySelector('.c-prf');
  prfI.value = prf.toFixed(2);
  prfI.className = 'cell-input c-prf ' + (prf<0?'profit-neg':'profit-pos');
}

// ‚îÄ‚îÄ‚îÄ SAVE BILL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveBill(){
  const bn = document.getElementById('billName').value.trim();
  const dn = document.getElementById('distName').value.trim();
  if(!bn){ toast('‚ö†Ô∏è Enter a bill name'); return; }
  if(!dn){ toast('‚ö†Ô∏è Enter distributor name'); return; }
  S.distName=dn; save();
  const lv=getLevel();
  const rows=document.querySelectorAll('#tableBody tr');
  const prods=[];
  rows.forEach(r=>{
    const name=r.querySelector('.c-name').value.trim();
    if(!name) return;
    const bp=parseFloat(r.querySelector('.c-bp').value)||0;
    if(!bp) return;
    const mrp=parseFloat(r.querySelector('.c-mrp').value)||0;
    const mk=parseFloat(r.querySelector('.c-mk').value)||0;
    const qty=parseInt(r.querySelector('.c-qty').value)||1;
    const sp=parseFloat(r.querySelector('.c-sp').value)||0;
    const fp=parseFloat(r.querySelector('.c-fp').value)||0;
    const prf=parseFloat(r.querySelector('.c-prf').value)||0;
    prods.push({name,mrp,buyPrice:bp,markup:mk,quantity:qty,sellPrice:sp,finalPrice:fp,profit:prf,level:lv});
  });
  if(!prods.length){ toast('‚ö†Ô∏è Add at least one product with a buy price'); return; }
  S.bills.push({id:Date.now(),name:bn,distributor:dn,products:prods,level:lv,levelLabel:LEVEL_LABEL[lv],savedDate:new Date().toLocaleDateString('en-IN',{year:'numeric',month:'short',day:'numeric'}),timestamp:Date.now()});
  save();
  toast('‚úì Bill saved!');
  document.getElementById('billName').value='';
  document.getElementById('tableBody').innerHTML='';
  rowId=0;
  for(let i=0;i<4;i++) addRow();
}

// ‚îÄ‚îÄ‚îÄ RENDER BILLS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBills(){
  const q=(document.getElementById('searchInput').value||'').toLowerCase();
  const bills=(S.bills||[]).filter(b=>b.name.toLowerCase().includes(q));
  const wrap=document.getElementById('billsGrid');
  if(!bills.length){
    wrap.innerHTML=`<div class="empty"><div class="empty-icon">üìã</div><h3>${q?'No results found':'No saved bills yet'}</h3><p>${q?'Try a different search':'Go to Product Input and save your first bill.'}</p></div>`;
    return;
  }
  wrap.innerHTML=bills.map(b=>{
    const rev=b.products.reduce((s,p)=>s+p.finalPrice,0);
    const prf=b.products.reduce((s,p)=>s+p.profit,0);
    const isLoss=prf<0;
    return `<div class="bill-card" data-bid="${b.id}">
      <div class="bill-card-top">
        <div class="bill-card-meta">
          <h3>${b.name}</h3>
          <div class="bill-meta-row">
            <span class="bill-meta-pill">üìÖ ${b.savedDate}</span>
            <span class="bill-meta-pill">üè∑Ô∏è ${b.levelLabel||b.level||'‚Äî'}</span>
            <span class="bill-meta-pill">üì¶ ${b.products.length} items</span>
          </div>
        </div>
        <div class="bill-card-actions">
          <button class="btn btn-outline" onclick="viewBill(${b.id})" style="padding:8px 14px;font-size:12.5px">View</button>
          <button class="btn btn-blue" onclick="downloadBill(${b.id})" style="padding:8px 14px;font-size:12.5px">PDF</button>
          <button class="btn btn-red" onclick="deleteBill(${b.id})" style="padding:8px 14px;font-size:12.5px">Delete</button>
        </div>
      </div>
      <div class="bill-divider"></div>
      <div class="bill-items-list">
        ${b.products.slice(0,4).map(p=>`
          <div class="bill-item-row">
            <div class="bill-item-name">${p.name}</div>
            <div class="bill-item-stats">
              <span>√ó${p.quantity}</span>
              <span>Buy ‚Çπ${p.buyPrice.toFixed(0)}</span>
              <span>Total ‚Çπ${p.finalPrice.toFixed(0)}</span>
            </div>
          </div>`).join('')}
        ${b.products.length>4?`<div style="font-size:12px;color:var(--fg3);padding:8px 0">+ ${b.products.length-4} more items</div>`:''}
      </div>
      <div class="bill-card-footer">
        <div class="footer-stat">
          <div class="footer-stat-label">Revenue</div>
          <div class="footer-stat-val">‚Çπ${rev.toFixed(0)}</div>
        </div>
        <div class="footer-stat">
          <div class="footer-stat-label">${isLoss?'Loss':'Profit'}</div>
          <div class="footer-stat-val ${isLoss?'red':'green'}">‚Çπ${Math.abs(prf).toFixed(0)}</div>
        </div>
        <div class="footer-stat">
          <div class="footer-stat-label">Margin</div>
          <div class="footer-stat-val">${rev>0?((prf/rev)*100).toFixed(1):0}%</div>
        </div>
      </div>
    </div>`;
  }).join('');
}

function searchBills(){ renderBills(); }

function deleteBill(id){
  if(!confirm('Delete this bill?')) return;
  S.bills=S.bills.filter(b=>b.id!==id); save(); renderBills(); renderSummary(); toast('Deleted');
}

// ‚îÄ‚îÄ‚îÄ VIEW MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function viewBill(id){
  const b=S.bills.find(x=>x.id===id); if(!b) return;
  document.getElementById('modalTitle').textContent=b.name;
  document.getElementById('modalSub').textContent=`${b.savedDate} ¬∑ Level: ${b.levelLabel||b.level}`;
  document.getElementById('modalItems').innerHTML=b.products.map(p=>{
    const isLoss=p.profit<0;
    return `<div class="modal-item">
      <h4>${p.name}</h4>
      <div class="modal-detail"><span>MRP</span><strong>‚Çπ${(p.mrp||0).toFixed(2)}</strong></div>
      <div class="modal-detail"><span>Buy Price (your cost)</span><strong>‚Çπ${p.buyPrice.toFixed(2)}</strong></div>
      <div class="modal-detail"><span>Markup</span><strong>${p.markup.toFixed(2)}%</strong></div>
      <div class="modal-detail"><span>Sell Price / unit</span><strong style="color:var(--green)">‚Çπ${p.sellPrice.toFixed(2)}</strong></div>
      <div class="modal-detail"><span>Qty</span><strong>${p.quantity}</strong></div>
      <div class="modal-detail"><span>Total</span><strong style="color:var(--green)">‚Çπ${p.finalPrice.toFixed(2)}</strong></div>
      <div class="modal-detail"><span>${isLoss?'Loss':'Profit'}</span><strong style="color:${isLoss?'#ef4444':'var(--green)'}">‚Çπ${Math.abs(p.profit).toFixed(2)}</strong></div>
    </div>`;
  }).join('');
  document.getElementById('modal').classList.add('open');
}

function closeModal(){ document.getElementById('modal').classList.remove('open'); }
document.getElementById('modal').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeModal(); });

// ‚îÄ‚îÄ‚îÄ DOWNLOAD PDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function downloadBill(id){
  const b=S.bills.find(x=>x.id===id); if(!b) return;
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});
  const W=doc.internal.pageSize.getWidth(), H=doc.internal.pageSize.getHeight();
  const m=15, cw=W-m*2;
  let y=0;

  // ‚îÄ‚îÄ Header banner ‚îÄ‚îÄ
  doc.setFillColor(22,163,74);
  doc.rect(0,0,W,32,'F');

  doc.setTextColor(255,255,255);
  doc.setFontSize(20); doc.setFont('helvetica','bold');
  doc.text('Herbalife',m,14);
  doc.setFontSize(9); doc.setFont('helvetica','normal');
  doc.text('Independent Distributor',m,21);

  doc.setFontSize(11); doc.setFont('helvetica','bold');
  doc.text('INVOICE',W-m,13,{align:'right'});
  doc.setFontSize(8.5); doc.setFont('helvetica','normal');
  doc.text(`Date: ${b.savedDate}`,W-m,20,{align:'right'});
  doc.text(`Ref: ${b.name}`,W-m,26,{align:'right'});

  y=42;

  // ‚îÄ‚îÄ From box ‚îÄ‚îÄ
  doc.setFillColor(240,253,244);
  doc.setDrawColor(187,247,208);
  doc.roundedRect(m,y,cw/2-6,22,3,3,'FD');
  doc.setTextColor(22,101,52); doc.setFontSize(8); doc.setFont('helvetica','bold');
  doc.text('FROM',m+5,y+7);
  doc.setTextColor(30,30,30); doc.setFont('helvetica','normal'); doc.setFontSize(9);
  doc.text(b.distributor||'Distributor',m+5,y+14);
  doc.setFontSize(8); doc.setTextColor(100,100,100);
  doc.text('Herbalife Independent Distributor',m+5,y+20);

  y+=32;

  // ‚îÄ‚îÄ Divider ‚îÄ‚îÄ
  doc.setDrawColor(187,247,208); doc.setLineWidth(0.4);
  doc.line(m,y,W-m,y); y+=8;

  // ‚îÄ‚îÄ Table ‚Äî customer-facing columns only ‚îÄ‚îÄ
  const cols=[
    {l:'#',             w:10, align:'left'},
    {l:'Product',       w:95, align:'left'},
    {l:'MRP (‚Çπ)',       w:24, align:'right'},
    {l:'Price/Unit (‚Çπ)',w:28, align:'right'},
    {l:'Qty',           w:14, align:'right'},
    {l:'Amount (‚Çπ)',    w:19, align:'right'},
  ];

  doc.setFillColor(22,163,74);
  doc.rect(m,y,cw,9,'F');
  doc.setTextColor(255,255,255); doc.setFontSize(8.5); doc.setFont('helvetica','bold');
  let cx=m+3;
  cols.forEach(c=>{
    if(c.align==='right') doc.text(c.l, cx+c.w-3, y+6, {align:'right'});
    else doc.text(c.l, cx, y+6);
    cx+=c.w;
  });
  y+=9;

  doc.setFont('helvetica','normal');
  let grandTotal=0;
  b.products.forEach((p,i)=>{
    const rh=10;
    if(y+rh>H-40){
      doc.addPage(); y=m;
      doc.setFillColor(22,163,74); doc.rect(m,y,cw,9,'F');
      doc.setTextColor(255,255,255); doc.setFontSize(8.5); doc.setFont('helvetica','bold');
      let hx=m+3;
      cols.forEach(c=>{ if(c.align==='right') doc.text(c.l,hx+c.w-3,y+6,{align:'right'}); else doc.text(c.l,hx,y+6); hx+=c.w; });
      y+=9; doc.setFont('helvetica','normal');
    }

    if(i%2===0){ doc.setFillColor(240,253,244); doc.rect(m,y,cw,rh,'F'); }
    doc.setTextColor(30,30,30); doc.setFontSize(8.5);

    let name=p.name;
    const maxW=cols[1].w-4;
    while(doc.getTextWidth(name)>maxW&&name.length>4) name=name.slice(0,-1);
    if(name!==p.name) name=name.slice(0,-1)+'‚Ä¶';

    const row=[
      String(i+1),
      name,
      `${(p.mrp||0).toFixed(0)}`,
      `${p.sellPrice.toFixed(0)}`,
      String(p.quantity),
      `${p.finalPrice.toFixed(0)}`,
    ];

    cx=m+3;
    row.forEach((v,vi)=>{
      if(cols[vi].align==='right') doc.text(v, cx+cols[vi].w-3, y+7, {align:'right'});
      else doc.text(v, cx, y+7);
      cx+=cols[vi].w;
    });

    doc.setDrawColor(187,247,208); doc.setLineWidth(0.15);
    doc.line(m,y+rh,m+cw,y+rh);
    grandTotal+=p.finalPrice;
    y+=rh;
  });

  // ‚îÄ‚îÄ Total row ‚îÄ‚îÄ
  y+=4;
  doc.setDrawColor(22,163,74); doc.setLineWidth(0.6);
  doc.line(m,y,W-m,y); y+=2;
  doc.setFillColor(220,252,231);
  doc.rect(m,y,cw,12,'F');
  doc.setTextColor(22,101,52); doc.setFontSize(11); doc.setFont('helvetica','bold');
  doc.text('TOTAL',m+5,y+9);
  doc.text(`Rs. ${grandTotal.toFixed(2)}`,W-m-3,y+9,{align:'right'});
  y+=20;

  doc.setFontSize(8.5); doc.setFont('helvetica','normal'); doc.setTextColor(120,120,120);
  doc.text(`${b.products.length} item(s)  ¬∑  All prices in INR`,m,y);

  // ‚îÄ‚îÄ Footer ‚îÄ‚îÄ
  doc.setFillColor(240,253,244);
  doc.rect(0,H-20,W,20,'F');
  doc.setDrawColor(187,247,208); doc.setLineWidth(0.3);
  doc.line(0,H-20,W,H-20);
  doc.setFontSize(8.5); doc.setTextColor(80,80,80); doc.setFont('helvetica','italic');
  doc.text('Thank you for your purchase! For queries, contact your Herbalife distributor.',W/2,H-11,{align:'center'});
  doc.setFont('helvetica','normal'); doc.setFontSize(7.5); doc.setTextColor(150,150,150);
  doc.text(`Generated: ${new Date().toLocaleString()}`,m,H-5);
  doc.text('Made by Vedant Suryawanshi',W-m,H-5,{align:'right'});

  doc.save(`${b.name.replace(/[^a-zA-Z0-9_\- ]/g,'').trim().replace(/\s+/g,'_')}_invoice.pdf`);
  toast('üìÑ Invoice downloaded!');
}

// ‚îÄ‚îÄ‚îÄ SUMMARY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderSummary(){
  const all=(S.bills||[]).flatMap(b=>b.products);
  const rev=all.reduce((s,p)=>s+p.finalPrice,0);
  const prf=all.reduce((s,p)=>s+p.profit,0);
  document.getElementById('sTotalBills').textContent=S.bills.length;
  document.getElementById('sTotalProds').textContent=all.length;
  document.getElementById('sTotalRev').textContent=`‚Çπ${rev.toFixed(0)}`;
  const el=document.getElementById('sTotalProfit');
  el.textContent=prf>=0?`‚Çπ${prf.toFixed(0)}`:`-‚Çπ${Math.abs(prf).toFixed(0)}`;
  el.className='stat-card-val '+(prf<0?'':'green');
}

function exportCSV(){
  if(!S.bills.length){ toast('No bills to export'); return; }
  let csv='Bill,Date,Level,Product,MRP,BuyPrice,Markup%,SellPrice,Qty,FinalPrice,Profit\n';
  S.bills.forEach(b=>b.products.forEach(p=>{
    csv+=`"${b.name}","${b.savedDate}","${b.levelLabel||b.level}","${p.name}",${p.mrp||0},${p.buyPrice},${p.markup},${p.sellPrice},${p.quantity},${p.finalPrice},${p.profit}\n`;
  }));
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download=`herbalife_${new Date().toISOString().split('T')[0]}.csv`; a.click();
}

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toast(msg){
  const el=document.createElement('div'); el.className='toast'; el.textContent=msg;
  document.getElementById('toastWrap').appendChild(el);
  setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(10px)'; el.style.transition='all 0.25s'; setTimeout(()=>el.remove(),260); },2500);
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function init(){
  load();
  if(S.dark){ document.body.classList.add('dark'); document.getElementById('darkBtn').textContent='‚òÄÔ∏è'; }
  if(S.distName){ document.getElementById('distName').value=S.distName; }
  document.getElementById('distLevel').value=S.level||'p50';
  document.getElementById('globalMarkup').value=S.markup||0;
  if(S.auto){ document.getElementById('autoToggle').classList.add('on'); document.getElementById('autoLabel').textContent='On ‚Äî syncing all rows'; }
  for(let i=0;i<4;i++) addRow();
  document.getElementById('distName').addEventListener('change', function(){ S.distName=this.value.trim(); save(); });
})();
</script>
</body>
</html>
